---
import Layout from '../layouts/Slide.astro';
---

<style>
  @import url('https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;700;800&display=swap');

  /* --- LAYOUT --- */
  .slide-container {
    width: 100%;
    height: 100vh;
    background-color: #ffffff;
    background-image: radial-gradient(circle at 50% 50%, #f8fafc 0%, #e2e8f0 100%);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-family: 'Manrope', system-ui, sans-serif;
    overflow: hidden;
    position: relative;
  }

  /* CANVAS DE CONFETI */
  #confetti-canvas {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 1;
    pointer-events: none;
  }

  /* CONTENIDO CENTRAL */
  .content-wrapper {
    z-index: 10;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2rem;
  }

  /* --- TÍTULO GIGANTE --- */
  h1 {
    font-size: 8rem;
    font-weight: 900;
    margin: 0;
    line-height: 0.9;
    letter-spacing: -4px;
    background: linear-gradient(135deg, #0f172a 0%, #1D4E89 50%, #3b82f6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 10px 20px rgba(29, 78, 137, 0.2));
    opacity: 0;
    animation: zoomReveal 1s cubic-bezier(0.34, 1.56, 0.64, 1) 0.2s forwards;
  }

  .subtitle {
    font-size: 1.5rem;
    color: #64748b;
    font-weight: 500;
    margin-top: -10px;
    opacity: 0;
    animation: fadeInUp 0.8s ease-out 0.6s forwards;
  }

  /* --- TARJETA DE CONTACTO --- */
  .contact-card {
    margin-top: 3rem;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.8);
    padding: 1.5rem 3rem;
    border-radius: 20px;
    box-shadow: 0 20px 40px -10px rgba(29, 78, 137, 0.15);
    display: flex;
    gap: 3rem;
    align-items: center;
    opacity: 0;
    transform: translateY(30px);
    animation: fadeInUp 0.8s ease-out 1s forwards;
  }

  .contact-item {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .icon-box {
    width: 40px; height: 40px;
    background: #1D4E89;
    color: white;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 4px 10px rgba(29, 78, 137, 0.3);
  }

  .info-text strong { display: block; font-size: 0.8rem; color: #64748b; text-transform: uppercase; letter-spacing: 1px; }
  .info-text span { font-size: 1.1rem; font-weight: 700; color: #0f172a; }

  .divider { width: 1px; height: 40px; background: #cbd5e1; }

  .bg-circle {
    position: absolute; border-radius: 50%; z-index: 0; filter: blur(80px); opacity: 0.4;
  }
  .c1 { width: 600px; height: 600px; background: #e0f2fe; top: -20%; left: -10%; animation: float 10s infinite; }
  .c2 { width: 500px; height: 500px; background: #f0fdf4; bottom: -10%; right: -10%; animation: float 12s infinite reverse; }

  @keyframes zoomReveal {
    0% { opacity: 0; transform: scale(0.8) translateY(20px); }
    100% { opacity: 1; transform: scale(1) translateY(0); }
  }
  @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes float { 0% { transform: translate(0,0); } 100% { transform: translate(30px, -30px); } }

</style>

<Layout title="Gracias">
  <div class="slide-container">
    <div class="bg-circle c1"></div>
    <div class="bg-circle c2"></div>
    <canvas id="confetti-canvas"></canvas>
    <div class="content-wrapper">
      
      <h1>¡Gracias!</h1>

      <div class="contact-card">
        <div class="contact-item">
          <div class="icon-box">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
          </div>
          <div class="info-text">
            <strong>Repositorio del Proyecto</strong>
            <span>github.com/redigb/proyecto-zidra-autoscore</span>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    // Obtenemos el canvas de manera segura
    const canvas = document.getElementById('confetti-canvas');
    
    // Validación de seguridad para evitar errores de "Property 'width' does not exist"
    if (canvas instanceof HTMLCanvasElement) {
        const ctx = canvas.getContext('2d');

        if (ctx) {
            let width = window.innerWidth;
            let height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;

            const colors = ['#1D4E89', '#0f172a', '#3b82f6', '#10b981', '#cbd5e1'];

            class Particle {
                // SOLUCIÓN: Declarar las propiedades antes del constructor
                x; y; vx; vy; gravity; color; size; rotation; rotationSpeed; opacity; shape;

                constructor() {
                    this.x = width / 2; 
                    this.y = height / 2 + 100;
                    this.vx = (Math.random() - 0.5) * 25; 
                    this.vy = (Math.random() - 1) * 25 - 5; 
                    this.gravity = 0.4;
                    this.color = colors[Math.floor(Math.random() * colors.length)];
                    this.size = Math.random() * 8 + 4;
                    this.rotation = Math.random() * 360;
                    this.rotationSpeed = (Math.random() - 0.5) * 10;
                    this.opacity = 1;
                    this.shape = Math.random() > 0.5 ? 'rect' : 'circle'; 
                }

                update() {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.vy += this.gravity;
                    this.rotation += this.rotationSpeed;
                    this.opacity -= 0.008;
                }

                draw() {
                    // Solo dibujamos si ctx es válido (ya lo comprobamos arriba)
                    // TypeScript a veces pierde el contexto dentro de closures, 
                    // así que podemos usar una aserción o pasarlo como argumento si fuera necesario,
                    // pero aquí ctx está en el scope.
                    
                    const context = ctx!; // El signo ! le dice a TS que estamos seguros de que no es null

                    context.save();
                    context.globalAlpha = this.opacity;
                    context.translate(this.x, this.y);
                    context.rotate((this.rotation * Math.PI) / 180);
                    context.fillStyle = this.color;

                    if (this.shape === 'rect') {
                        context.fillRect(-this.size / 2, -this.size / 2, this.size, this.size);
                    } else {
                        context.beginPath();
                        context.arc(0, 0, this.size / 2, 0, Math.PI * 2);
                        context.fill();
                    }
                    
                    context.restore();
                }
            }

            let particles: Particle[] = []; // Tipado explícito del array

            function explodeConfetti() {
                for (let i = 0; i < 150; i++) {
                    particles.push(new Particle());
                }
            }

            function animate() {
                const context = ctx!;
                context.clearRect(0, 0, width, height);
                
                for (let i = 0; i < particles.length; i++) {
                    particles[i].update();
                    particles[i].draw();
                    
                    if (particles[i].opacity <= 0 || particles[i].y > height) {
                        particles.splice(i, 1);
                        i--;
                    }
                }
                
                requestAnimationFrame(animate);
            }

            animate();
            setTimeout(explodeConfetti, 500);
            setTimeout(explodeConfetti, 1200);

            window.addEventListener('resize', () => {
                width = window.innerWidth;
                height = window.innerHeight;
                canvas.width = width;
                canvas.height = height;
            });
        }
    }
  </script>
</Layout>